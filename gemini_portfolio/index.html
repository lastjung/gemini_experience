<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 3.0 Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;700&family=Orbitron:wght@400;700&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neonCyan: '#00f3ff',
                        neonPurple: '#bc13fe',
                        deepSpace: '#050510'
                    },
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        tech: ['Orbitron', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            margin: 0;
            background: #050510;
            color: white;
            overflow-x: hidden;
        }

        #canvas-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .glass-card {
            background: rgba(20, 20, 30, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .glass-card:hover {
            transform: translateY(-10px) scale(1.02);
            background: rgba(30, 30, 50, 0.6);
            border-color: rgba(0, 243, 255, 0.6);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.15);
        }

        /* Iframe fix */
        iframe {
            border: none;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background: #000;
        }

        #loader {
            z-index: 10;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00f3ff;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .text-shadow-glow {
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.7);
        }

        /* --- Interaction Styles for Dynamic Cards --- */
        .preserve-3d {
            transform-style: preserve-3d;
        }

        .slide-content {
            transform: translateY(1.5rem);
            transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .glass-card:hover .slide-content {
            transform: translateY(-0.5rem);
            /* Moved down to give more top space */
        }

        .reveal-content {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .glass-card:hover .reveal-content {
            max-height: 24rem;
            /* Allow full expansion */
            opacity: 1;
            margin-top: 1.5rem;
            /* Increased spacing to fill vertical gap */
        }

        /* Mobile Optimization: Always reveal content on touch devices */
        @media (max-width: 768px),
        (hover: none) {
            .slide-content {
                transform: translateY(0) !important;
            }

            .reveal-content {
                max-height: 24rem !important;
                opacity: 1 !important;
                margin-top: 1.5rem !important;
            }

            .glass-card {
                padding: 1.5rem !important;
            }
        }
    </style>
</head>

<body>
    <canvas id="canvas-bg"></canvas>

    <!-- Header -->
    <header
        class="fixed top-0 w-full z-40 p-4 md:p-6 flex justify-center md:justify-between items-center mix-blend-difference pointer-events-none">
        <div
            class="text-xl md:text-2xl font-tech font-bold tracking-widest text-neonCyan pointer-events-auto text-center md:text-left">
            GEMINI<span class="text-white">3.0</span>
            <span class="block md:inline text-[10px] md:text-xs text-neonPurple md:ml-2 tracking-normal font-sans">with
                Antigravity</span>
        </div>
        <div class="hidden md:block text-sm font-light text-gray-400">DEVELOPER PORTFOLIO</div>
    </header>

    <!-- Main Content -->
    <main class="relative z-10 pt-48 pb-20 px-4 container mx-auto">
        <!-- Hero Section -->
        <section class="text-center mb-20 relative select-none">
            <h1 class="text-6xl md:text-8xl font-bold mb-6 font-tech tracking-tighter opacity-0 translate-y-10 leading-none pointer-events-none"
                id="hero-title">
                <span
                    class="bg-clip-text text-transparent bg-gradient-to-r from-neonCyan to-neonPurple filter drop-shadow-[0_0_10px_rgba(0,243,255,0.5)]">ANTI-GRAVITY</span><br>
                <span
                    class="bg-clip-text text-transparent bg-gradient-to-r from-neonPurple to-neonCyan filter drop-shadow-[0_0_10px_rgba(188,19,254,0.5)]">EXPERIENCE</span>
            </h1>
            <p class="text-xl md:text-2xl text-gray-400 font-light max-w-2xl mx-auto opacity-0 translate-y-10 pointer-events-none"
                id="hero-desc">
                Click the <span id="galaxy-text-trigger"
                    class="text-neonPurple font-bold cursor-pointer hover:underline pointer-events-auto">Galaxy</span>
                to Explore. Scroll to discover Projects.
            </p>

            <!-- Hidden Galaxy Label -->
            <div id="galaxy-label"
                class="absolute inset-0 flex flex-col items-center justify-center opacity-0 pointer-events-none transform translate-y-48 mt-20">
                <h2 class="text-4xl md:text-6xl font-tech text-white mb-2 tracking-widest text-shadow-glow">GEMINI
                    SECTOR</h2>
                <div class="h-1 w-24 bg-neonCyan rounded-full mb-4"></div>
                <p class="text-neonPurple font-mono text-sm tracking-[0.3em]">SYSTEM COORDINATES: 04-20-80</p>
            </div>

            <div class="mt-12 animate-bounce opacity-0" id="hero-scroll">
                <svg class="w-6 h-6 mx-auto text-neonCyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                </svg>
            </div>
        </section>

        <!-- Projects Grid -->
        <section id="projects" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 max-w-7xl mx-auto">
            <!-- Cards injected via JS -->
        </section>
    </main>



    <!-- Project Modal -->
    <div id="modal"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/95 backdrop-blur-xl hidden transition-opacity duration-300 opacity-0">
        <div
            class="bg-[#0f0f1a] w-full h-full md:w-[95%] md:h-[90%] rounded-2xl border border-white/10 flex flex-col relative overflow-hidden shadow-2xl shadow-neonPurple/20">
            <!-- Modal Header -->
            <div class="h-14 flex items-center justify-between px-6 border-b border-white/60 bg-black/60">
                <h3 id="modal-title" class="text-lg font-tech text-neonCyan tracking-wider">PROJECT NAME</h3>
                <div class="flex gap-4">
                    <a id="modal-newtab" href="#" target="_blank"
                        class="text-xs text-gray-400 hover:text-white flex items-center gap-1 transition-colors">
                        OPEN IN NEW TAB â†—
                    </a>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-neonPurple transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Iframe Container -->
            <div class="flex-1 relative bg-black">
                <div id="loader"
                    class="absolute inset-0 flex items-center justify-center text-neonCyan font-mono tracking-widest">
                    INITIALIZING SYSTEM...</div>
                <iframe id="project-frame" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const projects = [
            { id: 'neon_slime', name: 'Neon Jelly Slime', path: '../neon_slime/index.html', desc: 'A physics-based soft body simulation using Matter.js. Pull and interact with a massive, neon-glowing jelly structure that deforms and bounces with interconnected constraints.', tags: ['Matter.js', 'Physics'] },
            { id: 'chladni', name: 'Chladni Patterns', path: '../chladni_patterns/index.html', desc: 'A Cymatics simulation visualizing Chladni figures using 18,000 particles. Adjust frequencies to watch sand particles stochastically migrate to nodal lines on vibrating plates.', tags: ['Math', 'Canvas'] },
            { id: 'cyberpunk', name: 'Cyberpunk Globe', path: '../cyberpunk_globe/index.html', desc: 'An interactive 3D cyberpunk globe rotating in space. Features wireframe geometry, pulsating neon beacons, and a bloom-enhanced starfield environment built with Three.js.', tags: ['Three.js', '3D'] },
            { id: 'fluid', name: 'Fluid Particles', path: '../fluid_particles/index.html', desc: 'High-performance 2D fluid dynamics with 3,500+ particles. Watch particles disperse organically or form gradients based on velocity and density using a Spatial Hash Grid.', tags: ['Canvas', 'Optimization'] },
            { id: 'kaleidoscope', name: 'Kaleidoscope Shader', path: '../kaleidoscope_shader/index.html', desc: 'A raw WebGL fragment shader art piece. Renders infinite, psychedelic kaleidoscope patterns using complex math, real-time folding, and vibrant color cycling.', tags: ['WebGL', 'Shader'] },
            { id: 'shooter', name: 'Retro Shooter', path: '../synthwave_shooter/index.html', desc: 'A retro 80s synthwave shooter built entirely with Canvas drawing functions. Fly through an infinite perspective grid, blast enemies with screen-shake feedback, and enjoy dynamic parallax.', tags: ['Game', 'Retro'] },
            { id: 'ink', name: 'Ink Fluid Sim', path: '../ink_fluid_sim/index.html', desc: 'GPGPU-accelerated Stable Fluids simulation. Experience mesmerizing, aurora-colored ink diffusion and vorticity calculated directly on the GPU for massive particle counts.', tags: ['WebGL', 'Physics'] },
            { id: 'matrix', name: '3D Matrix Rain', path: '../matrix_rain_3d/index.html', desc: 'A 3D reinterpretation of the digital rain from The Matrix. Fly through depth-of-field enhanced streams of glowing code characters generated via custom texture atlases.', tags: ['Three.js', 'Post-processing'] },
            { id: 'flight', name: 'Retrowave Flight', path: '../retrowave_terrain/index.html', desc: 'Infinite procedural flight simulation over a neon-grid terrain. Driven by Perlin Noise and vertex displacement, featuring a retro sun and rhythmic wave animations.', tags: ['Three.js', 'Noise'] },
            { id: 'hud', name: 'Sci-Fi HUD', path: '../sci_fi_hud/index.html', desc: 'Complex Sci-Fi Head-Up Display using pure CSS animations and SVG. Features rotating arc reactors, data streams, and holographic glitch effects without heavy JS dependencies.', tags: ['CSS', 'UI'] },
            { id: 'velvet', name: 'Velvet Cloth', path: '../velvet_simulation/index.html', desc: 'Tearable cloth physics simulation using Verlet Integration. Interact with a silky red velvet mesh that ripples in the wind and can be cut or torn by mouse gestures.', tags: ['Verlet', 'Physics'] },
            { id: 'sand', name: 'Falling Sand', path: '../falling_sand_game/index.html', desc: 'Pixel-based "Falling Sand" alchemy game. Experiment with elemental physics where sand piles up, fire evaporates water into steam, and acid dissolves terrain.', tags: ['Canvas', 'Simulation'] },
            { id: 'ants', name: 'Ant Colony', path: '../ant_colony/index.html', desc: 'Visualizing Ant Colony Optimization algorithms. Watch 1,200 autonomous agents find the shortest path to food sources using distinct pheromone trails and evaporation logic.', tags: ['AI', 'Algorithm'] },
            { id: 'chain', name: 'Rusty Chain', path: '../rusty_chain/index.html', desc: 'Heavy physical interaction demo with a rusty industrial chain. Uses Matter.js constraints to simulate realistic weight, friction, and collision as you smash wooden crates.', tags: ['Matter.js', 'Physics'] },
            { id: 'agency', name: 'AETHER Agency', path: '../creative_agency/index.html', desc: 'Immersive 3D brand site for "AETHER". Features a liquid particle background, magnetic cursor interactions, and cinematic scroll-triggered text reveals.', tags: ['Three.js', 'Design'] },
            { id: 'resume', name: 'Immersive Resume', path: '../immersive_resume/index.html', desc: 'Futuristic developer portfolio featuring a 3D ambient particle system and Glassmorphism UI. Sections float and reveal smoothly as you scroll through deep space.', tags: ['Three.js', 'UI'] },
            { id: 'mcp', name: 'MCP Landing', path: '../mcp_landing/index.html', desc: 'Educational landing page for the Model Context Protocol. Explains complex system architectures with animated diagrams, glowing cards, and intersection-observer reveals.', tags: ['CSS', 'Animation'] },
        ];

        // --- DOM Logic ---
        const projectsContainer = document.getElementById('projects');
        const modal = document.getElementById('modal');
        const frame = document.getElementById('project-frame');
        const modalTitle = document.getElementById('modal-title');
        const modalNewTab = document.getElementById('modal-newtab');
        const loader = document.getElementById('loader');
        const galaxyLabel = document.getElementById('galaxy-label'); // Get the new element


        // Fix paths for root symlink usage
        projects.forEach(p => {
            if (!window.location.pathname.includes('/gemini_portfolio/')) {
                p.path = p.path.replace('../', './');
            }
        });

        projects.forEach((p, index) => {
            const card = document.createElement('div');
            // Added 'transition-transform duration-100 ease-out' for smooth tilt, removed 'translate-y-10' for initial state logic handled by GSAP
            card.className = 'glass-card rounded-xl p-8 cursor-pointer relative overflow-hidden group opacity-0 translate-y-10 card-entry transition-transform duration-100 ease-out preserve-3d';
            const hue = (index * 25) % 360;

            card.innerHTML = `
                <!-- Glow Background -->
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-[hsl(${hue},70%,50%)] rounded-full blur-[80px] opacity-10 group-hover:opacity-30 transition-opacity duration-500"></div>
                
                <div class="relative z-10 flex flex-col h-full justify-end pointer-events-none">
                    <!-- Top ID (Always Visible -> Fades Out on Hover) -->
                    <div class="absolute top-0 left-0 text-xs font-mono text-gray-500 transition-all duration-500 group-hover:opacity-0">0${index + 1} // ${p.tags[0]}</div>
                    
                    <!-- Content Container -->
                    <div class="slide-content">
                        <!-- Title -->
                        <h3 class="text-3xl font-bold font-tech text-white group-hover:text-neonCyan transition-colors duration-300 mb-1 leading-tight">${p.name}</h3>
                        
                        <!-- Hidden Info (Reveals on Hover) -->
                        <div class="reveal-content">
                             <p class="text-sm text-gray-300 font-light mt-3 mb-6 leading-relaxed line-clamp-6">${p.desc}</p>
                             <div class="flex gap-2 flex-wrap">
                                ${p.tags.map(t => `<span class="px-2 py-1 text-[10px] border border-white/10 bg-white/5 rounded-full text-gray-300 font-mono">${t}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arrow Icon -->
                <div class="absolute bottom-8 right-4 opacity-0 group-hover:opacity-100 transition-all duration-300 transform group-hover:translate-x-0 translate-x-4">
                    <svg class="w-6 h-6 text-neonCyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                </div>
            `;

            // Interaction: Open Modal
            card.addEventListener('click', () => openModal(p));

            // Interaction: 3D Tilt Effect
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                // Max tilt angle
                const rotateX = ((y - centerY) / centerY) * -10;
                const rotateY = ((x - centerX) / centerX) * 10;

                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
            });

            projectsContainer.appendChild(card);
        });

        // State to prevent double-opening and manage UI
        let isModalOpen = false;

        function openModal(project) {
            // Mobile Optimization: Open in new tab instead of modal
            if (window.innerWidth < 768) {
                window.open(project.path, '_blank');
                return;
            }

            if (isModalOpen) return;
            isModalOpen = true;

            modalTitle.textContent = project.name.toUpperCase();

            // Standard relative path - best for GitHub Pages/Web Server
            modalNewTab.href = project.path;

            loader.style.opacity = '1';

            // 1. Make visible to calculate dimensions
            modal.classList.remove('hidden');

            // 2. Clear previous state
            frame.src = 'about:blank';

            // 3. Load content after a brief delay to ensure layout is ready
            requestAnimationFrame(() => {
                frame.src = project.path;
            });

            // 4. Handle Load Event
            frame.onload = () => {
                // Only hide loader if valid content is loaded
                try {
                    // Check if not about:blank (might fail cross-origin locally in Safari)
                    if (frame.contentWindow.location.href !== 'about:blank') {
                        loader.style.opacity = '0';
                    }
                } catch (e) {
                    // Cross-origin restriction (expected in Safari local or some setups)
                    // If we can't read the location, assume it loaded if it didn't error out immediately
                    loader.style.opacity = '0';
                }
            };

            // 5. Fallback Safety Timer (Force hide loader after 2s)
            setTimeout(() => {
                loader.style.opacity = '0';
            }, 2000);

            // Fade In Modal
            setTimeout(() => {
                modal.classList.remove('opacity-0');
            }, 50);

            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            isModalOpen = false;
            modal.classList.add('opacity-0');

            setTimeout(() => {
                modal.classList.add('hidden');
                frame.src = 'about:blank';
                document.body.style.overflow = '';
                loader.style.opacity = '1'; // Reset loader for next time
            }, 300);
        }

        // --- 3D SPACE ENVIRONMENT ---
        const initThree = () => {
            const canvas = document.getElementById('canvas-bg');
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050510, 0.001);

            const isMobile = window.innerWidth < 768;
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            // Mobile Optimization: Move camera back to see more of the scene (Sun/Planets)
            camera.position.z = isMobile ? 250 : 100;

            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: false, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Helper: Circular Star Texture
            const getStarTexture = () => {
                const c = document.createElement('canvas');
                c.width = 32; c.height = 32;
                const ctx = c.getContext('2d');
                const g = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
                g.addColorStop(0, 'white');
                g.addColorStop(0.4, 'rgba(255,255,255,0.8)');
                g.addColorStop(1, 'transparent');
                ctx.fillStyle = g;
                ctx.fillRect(0, 0, 32, 32);
                return new THREE.CanvasTexture(c);
            };
            const starMap = getStarTexture();

            // 1. Stars (Soft Circles)
            const starGeo = new THREE.BufferGeometry();
            // Optimization: Reduce stars on mobile for performance
            const starCount = isMobile ? 1000 : 3000;
            const starPos = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount * 3; i++) {
                starPos[i] = (Math.random() - 0.5) * 1500;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
            const starMat = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 2.0, // Increased size for softness
                map: starMap,
                transparent: true,
                alphaTest: 0.01,
                opacity: 0.8
            });
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);

            // 2. Planets
            // Sun
            const sunGeo = new THREE.SphereGeometry(20, 32, 32);
            const sunMat = new THREE.MeshBasicMaterial({ color: 0xffaa00 });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            sun.position.set(-200, 100, -300);

            // Sun Glow
            const sunGlowGeo = new THREE.SphereGeometry(30, 32, 32);
            const sunGlowMat = new THREE.MeshBasicMaterial({ color: 0xff5500, transparent: true, opacity: 0.3, side: THREE.BackSide });
            const sunGlow = new THREE.Mesh(sunGlowGeo, sunGlowMat);
            sun.add(sunGlow);
            scene.add(sun);

            // Saturn
            const planetGeo = new THREE.SphereGeometry(15, 32, 32);
            const planetMat = new THREE.MeshPhongMaterial({ color: 0xaa88ff, shininess: 10 });
            const planet = new THREE.Mesh(planetGeo, planetMat);
            planet.position.set(200, -50, -200);

            // Saturn Ring
            const ringGeo = new THREE.RingGeometry(20, 30, 32);
            const ringMat = new THREE.MeshBasicMaterial({ color: 0xccaaff, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
            const ring = new THREE.Mesh(ringGeo, ringMat);
            ring.rotation.x = Math.PI / 2.5;
            planet.add(ring);

            // Lighting
            const planetLight = new THREE.PointLight(0xffffff, 1, 500);
            planetLight.position.set(200, 50, -150);
            scene.add(planetLight);
            scene.add(planet);

            // 3. Galaxy Spiral
            const galaxyGroup = new THREE.Group();
            const gCount = 5000;
            const gGeo = new THREE.BufferGeometry();
            const gPos = new Float32Array(gCount * 3);
            const gColors = new Float32Array(gCount * 3);
            const color1 = new THREE.Color(0xbc13fe); // Purple
            const color2 = new THREE.Color(0x00f3ff); // Cyan

            for (let i = 0; i < gCount; i++) {
                const angle = Math.random() * Math.PI * 2 * 3;
                const radius = Math.random() * 300 + 50;

                const x = Math.cos(angle) * radius;
                const y = (Math.random() - 0.5) * 50;
                const z = Math.sin(angle) * radius - 500;

                gPos[i * 3] = x;
                gPos[i * 3 + 1] = y;
                gPos[i * 3 + 2] = z;

                const mixedColor = color1.clone().lerp(color2, Math.random());
                gColors[i * 3] = mixedColor.r;
                gColors[i * 3 + 1] = mixedColor.g;
                gColors[i * 3 + 2] = mixedColor.b;
            }
            gGeo.setAttribute('position', new THREE.BufferAttribute(gPos, 3));
            gGeo.setAttribute('color', new THREE.BufferAttribute(gColors, 3));

            const gMat = new THREE.PointsMaterial({
                size: 3.5, // Even larger for galaxy dust
                vertexColors: true,
                map: starMap, // Use texture here too
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });
            const galaxy = new THREE.Points(gGeo, gMat);
            galaxyGroup.add(galaxy);

            // Galaxy Hitbox
            const hitGeo = new THREE.SphereGeometry(300, 16, 16);
            const hitMat = new THREE.MeshBasicMaterial({ visible: false });
            const galaxyHitbox = new THREE.Mesh(hitGeo, hitMat);
            galaxyHitbox.position.set(0, 0, -500);
            galaxyGroup.add(galaxyHitbox);
            scene.add(galaxyGroup);

            // Interaction: Zoom
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            let isZoomed = false;
            let isAnimating = false; // Debounce flag

            window.addEventListener('click', (event) => {
                if (isAnimating) return;
                if (event.target.closest('#projects') || event.target.closest('#modal')) return;

                // 1. Text Trigger Check
                if (event.target.id === 'galaxy-text-trigger' && !isZoomed) {
                    performZoomIn();
                    return;
                }

                if (isZoomed) {
                    // --- ZOOM OUT (Click Anywhere) ---
                    performZoomOut();
                } else {
                    // --- ZOOM IN (Raycast Check) ---
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects([galaxyHitbox], true);

                    if (intersects.length > 0) {
                        performZoomIn();
                    }
                }
            });

            function performZoomIn() {
                isAnimating = true;
                isZoomed = true;

                // Ensure audio is initialized immediately
                if (typeof initAudio === 'function') initAudio();

                // Audio: Warp In
                if (typeof SoundManager !== 'undefined' && SoundManager.active) {
                    SoundManager.playWarp(true);
                }

                gsap.to(camera.position, {
                    x: 0, y: 50, z: -300, duration: 2.5, ease: "power2.inOut",
                    onComplete: () => { isAnimating = false; }
                });
                gsap.to('#hero-title, #hero-desc', { autoAlpha: 0, duration: 0.3, overwrite: true });
                gsap.to('#galaxy-label', { autoAlpha: 1, duration: 1, delay: 0.5, overwrite: true });
            }

            function performZoomOut() {
                isAnimating = true;
                isZoomed = false;

                // Ensure audio is initialized immediately
                if (typeof initAudio === 'function') initAudio();

                // Audio: Warp Out (Rewind)
                if (typeof SoundManager !== 'undefined' && SoundManager.active) {
                    SoundManager.playWarp(false);
                }

                gsap.to(camera.position, {
                    x: 0, y: 0, z: 100, duration: 5.0, ease: "power2.inOut",
                    onComplete: () => { isAnimating = false; }
                });
                gsap.to('#galaxy-label', { autoAlpha: 0, duration: 0.3, overwrite: true });
                gsap.to('#hero-title, #hero-desc', { autoAlpha: 1, duration: 1, delay: 2.0, overwrite: true });
            }

            // Animation Loop
            let mouseX = 0, mouseY = 0;
            const handleInput = (x, y) => {
                mouseX = (x - window.innerWidth / 2) * 0.05;
                mouseY = (y - window.innerHeight / 2) * 0.05;
            };

            window.addEventListener('mousemove', e => handleInput(e.clientX, e.clientY));
            window.addEventListener('touchmove', e => {
                if (e.touches.length > 0) {
                    handleInput(e.touches[0].clientX, e.touches[0].clientY);
                }
            }, { passive: true });

            const animate = () => {
                requestAnimationFrame(animate);

                // Optimization: Pause rendering when modal is open to save resources for the iframe
                if (isModalOpen) return;

                stars.rotation.y += 0.0002;
                sun.rotation.y += 0.001;
                planet.rotation.y += 0.002;
                planet.rotation.z += 0.0005;
                galaxyGroup.rotation.z -= 0.0005;

                if (!isZoomed) {
                    camera.position.x += (mouseX - camera.position.x) * 0.05;
                    camera.position.y += (-mouseY - camera.position.y) * 0.05;
                    camera.lookAt(0, 0, -200); // Fixed lookAt
                } else {
                    camera.lookAt(0, 0, -500);
                }

                renderer.render(scene, camera);
            };
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);

                // Update Camera Z for Responsive Background
                const isMobileNow = window.innerWidth < 768;
                camera.position.z = isMobileNow ? 250 : 100;
            });
        };

        // --- Init ---
        // --- Init ---
        // Optimization: Use DOMContentLoaded for faster perceived load, instead of waiting for all assets
        document.addEventListener('DOMContentLoaded', () => {
            initThree();
            const tl = gsap.timeline();
            tl.to('#hero-title', { opacity: 1, y: 0, duration: 1.2, ease: 'power3.out' })
                .to('#hero-desc', { opacity: 1, y: 0, duration: 1 }, "-=0.5")
                .to('#hero-scroll', { opacity: 1, duration: 1 })
                .to('.card-entry', { opacity: 1, y: 0, duration: 0.8, stagger: 0.1, ease: 'back.out(1.2)', scrollTrigger: { trigger: "#projects", start: "top 85%" } });
            gsap.registerPlugin(ScrollTrigger);
        });
    </script>

    <script>
        // --- Sound Manager (Landing Page) ---
        const SoundManager = {
            ctx: null,
            active: false,
            droneNode: null,
            lastScroll: 0,

            init: function () {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.active = true;
                this.initScrollListener();
            },

            createOsc: function (type, freq) {
                const osc = this.ctx.createOscillator();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                return osc;
            },

            createGain: function (val) {
                const gain = this.ctx.createGain();
                gain.gain.setValueAtTime(val, this.ctx.currentTime);
                return gain;
            },



            // Warp Sound (Filter Sweep)
            playWarp: function (isIn) {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;

                // Noise Burst Layer
                const bufSize = this.ctx.sampleRate * 1.5; // 1.5s
                const buffer = this.ctx.createBuffer(1, bufSize, this.ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufSize; i++) data[i] = Math.random() * 2 - 1;

                const noise = this.ctx.createBufferSource();
                noise.buffer = buffer;

                const filter = this.ctx.createBiquadFilter();
                filter.type = isIn ? 'lowpass' : 'highpass';
                filter.Q.value = 5;

                const gain = this.createGain(0);

                if (isIn) {
                    // Warp In: Pitch Drop / Filter Open
                    filter.frequency.setValueAtTime(100, t);
                    filter.frequency.exponentialRampToValueAtTime(8000, t + 1.0); // Shooom

                    gain.gain.setValueAtTime(0, t);
                    gain.gain.linearRampToValueAtTime(0.3, t + 0.5);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + 1.5);
                } else {
                    // Warp Out: Rewind (Reverse Sweep) - Longer Duration (4s)
                    filter.frequency.setValueAtTime(8000, t);
                    filter.frequency.exponentialRampToValueAtTime(100, t + 4.0); // Ziiiuuum (Slower)

                    gain.gain.setValueAtTime(0, t);
                    gain.gain.linearRampToValueAtTime(0.2, t + 1.0);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + 4.0);
                }

                noise.connect(filter);
                filter.connect(gain);
                gain.connect(this.ctx.destination);
                noise.start(t);
            },

            // Scroll Beep
            playScrollBeep: function () {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;

                const osc = this.createOsc('sine', 1200);
                const gain = this.createGain(0.05);

                osc.frequency.setValueAtTime(1200, t);
                osc.frequency.exponentialRampToValueAtTime(600, t + 0.1);

                gain.gain.setValueAtTime(0.05, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start(t);
                osc.stop(t + 0.1);
            },

            initScrollListener: function () {
                let scrollTimeout;
                window.addEventListener('scroll', () => {
                    if (Date.now() - this.lastScroll > 200) { // Debounce start
                        this.playScrollBeep();
                        this.lastScroll = Date.now();
                    }
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        // Scroll stopped
                    }, 100);
                }, { passive: true });
            }
        };

        // UI status
        const audioStatus = document.createElement('div');
        Object.assign(audioStatus.style, {
            position: 'fixed', bottom: '20px', right: '20px',
            color: 'rgba(0, 243, 255, 0.5)', fontFamily: 'Orbitron, sans-serif', fontSize: '10px',
            pointerEvents: 'none', userSelect: 'none', textShadow: '0 0 5px rgba(0,243,255,0.5)', zIndex: 100
        });
        audioStatus.textContent = "SYSTEM: SILENT";
        document.body.appendChild(audioStatus);

        function initAudio() {
            if (!SoundManager.ctx) {
                SoundManager.init();
                audioStatus.textContent = "SYSTEM: ONLINE";
                audioStatus.style.opacity = "1";
            }
            if (SoundManager.ctx && SoundManager.ctx.state === 'suspended') {
                SoundManager.ctx.resume();
            }
        }

        window.addEventListener('click', initAudio);
        window.addEventListener('touchstart', initAudio, { passive: false });
    </script>
</body>

</html>